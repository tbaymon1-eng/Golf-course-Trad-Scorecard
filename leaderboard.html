<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Live Leaderboard</title>
  <meta name="theme-color" content="#7a4a0b" />

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --paper:#e9e2d4;
      --ink:#111;
      --border:#7a4a0b;
      --card:#efe7d7;
      --panel:rgba(255,255,255,.55);
      --line:rgba(0,0,0,.12);
      --shadow:0 10px 26px rgba(0,0,0,.18);
    }
    *{ -webkit-tap-highlight-color: transparent; box-sizing:border-box; }
    body{
      margin:0; background:var(--paper); color:var(--ink);
      font-family: Georgia, "Times New Roman", serif;
    }
    .wrap{ max-width: 980px; margin:0 auto; padding: 12px 10px 28px; }
    .card{
      background: var(--card);
      border: 3px solid var(--border);
      border-radius: 14px;
      overflow:hidden;
      box-shadow: var(--shadow);
    }

    /* Small header image (course-specific) */
    .hdr{
      display:flex;
      justify-content:center;
      padding:10px 10px 0;
      background:var(--card);
    }
    .hdr img{
      width:100%;
      max-width: 900px;
      height:auto;
      max-height: 110px;            /* üëà small */
      object-fit:contain;
      border-radius: 10px;
      border: 2px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.25);
    }

    .top{
      padding: 12px 12px 0;
    }
    h1{
      margin: 6px 0 2px;
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .6px;
      font-size: 34px;
    }
    .meta{
      font-size: 16px;
      opacity: .9;
      margin-bottom: 8px;
    }
    .club{
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .6px;
      font-size: 20px;
      margin: 2px 0 10px;
      text-transform: uppercase;
    }

    /* Sponsor hero */
    #sponsorHero{
      display:none;
      margin: 10px 0 10px;
      border: 2px solid var(--line);
      border-radius: 14px;
      background: var(--panel);
      padding: 12px 12px;
      cursor: pointer;
    }
    #sponsorHero:active{ transform: translateY(1px); }
    #sponsorHeroTitle{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 18px;
      letter-spacing: .5px;
      text-transform: uppercase;
    }
    #sponsorHeroRow{ display:flex; align-items:center; gap:12px; margin-top:10px; }
    #sponsorHeroLogo{
      width:56px; height:56px; border-radius:14px; object-fit:cover;
      border:2px solid rgba(0,0,0,.14);
      background: rgba(0,0,0,.06);
      display:none;
      flex:0 0 auto;
    }
    #sponsorHeroName{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 22px;
    }

    .pillRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin: 8px 0 10px;
      flex-wrap: wrap;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.45);
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .4px;
    }

    .btnRow{
      display:flex; gap:10px; flex-wrap:wrap;
      padding: 6px 0 14px;
    }
    button, .btn{
      border: 2px solid var(--border);
      background: #e7ddcb;
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 900;
      font-size: 18px;
      cursor:pointer;
      text-decoration:none;
      color:#111;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    button:active, .btn:active{ transform: translateY(1px); }

    .tvBtn{
      background:#1c1c1c;
      color:#fff;
      border-color:#000;
    }
    .autoBtn{
      min-width: 210px;
      justify-content:center;
    }

    .section{
      margin: 10px 12px 14px;
      border: 2px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.40);
      overflow:hidden;
    }
    .sectionHead{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap:10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.35);
    }
    .sectionHead .title{
      display:flex; align-items:center; gap:10px;
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 26px;
    }
    .sectionHead .sub{
      font-size: 16px;
      opacity: .9;
      margin-top: 2px;
    }

    /* Top team card */
    .topCard{
      margin: 12px 14px;
      padding: 14px 14px;
      border: 2px solid rgba(0,0,0,.12);
      border-radius: 16px;
      background: rgba(255,255,255,.55);
      cursor:pointer;
    }
    .topCard:active{ transform: translateY(1px); }
    .rankLine{
      display:flex; align-items:center; gap:10px;
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 22px;
    }
    .topName{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 34px;
      margin: 6px 0 2px;
    }
    .topScore{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 56px;
      line-height: 1;
      margin: 2px 0 8px;
    }
    .topMeta{
      font-size: 20px;
      opacity: .92;
    }

    /* All teams table */
    .tableWrap{
      overflow:auto;
      max-height: 420px; /* auto-scroll target */
      background: rgba(255,255,255,.35);
    }
    table{ width:100%; border-collapse: collapse; }
    th, td{
      border-top: 1px solid rgba(0,0,0,.10);
      padding: 14px 12px;
      text-align:left;
      vertical-align: middle;
      font-size: 18px;
    }
    th{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 20px;
      background: rgba(255,255,255,.45);
      position: sticky;
      top: 0;
      z-index: 2;
      border-top:none;
    }
    td .subline{ opacity:.85; font-size: 15px; margin-top: 2px; }
    .rankBadge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 54px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.55);
      font-family: Cinzel, serif;
      font-weight: 900;
    }
    .groupPill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 52px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.50);
      font-family: Cinzel, serif;
      font-weight: 900;
    }

    /* Modal (golf-like) */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 9999;
    }
    .modal{
      width: min(920px, 100%);
      background: var(--card);
      border: 3px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding: 14px 14px;
      background: rgba(255,255,255,.35);
      border-bottom: 1px solid rgba(0,0,0,.12);
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
    }
    .modalTitle{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 26px;
      line-height: 1.1;
    }
    .modalSmall{
      margin-top: 4px;
      font-size: 15px;
      opacity: .9;
    }
    .closeBtn{
      background:#b6422d;
      color:#fff;
      border-color:#7a2b20;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      font-size: 16px;
      cursor:pointer;
      white-space: nowrap;
    }

    .holesGrid{
      padding: 14px 14px 16px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 8px;
    }
    .cell{
      border: 2px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
      border-radius: 12px;
      padding: 10px 8px;
      text-align:center;
    }
    .cell .h{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 14px;
      opacity:.85;
    }
    .cell .v{
      margin-top: 6px;
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 22px;
      line-height: 1;
    }
    .cell .v.miss{ opacity:.35; }

    /* TV mode */
    body.tv .wrap{ max-width: 1400px; }
    body.tv h1{ font-size: 52px; }
    body.tv .club{ font-size: 28px; }
    body.tv .topName{ font-size: 46px; }
    body.tv .topScore{ font-size: 84px; }
    body.tv th{ font-size: 26px; }
    body.tv td{ font-size: 22px; }
    body.tv .tableWrap{ max-height: 72vh; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="hdr">
        <img id="courseHeader" src="./assets/cypresswood_header.png" alt="Course Header" />
      </div>

      <div class="top">
        <h1 id="pageTitle">LIVE LEADERBOARD</h1>
        <div class="meta" id="pageMeta">Loading‚Ä¶</div>
        <div class="club" id="clubLine">CYPRESSWOOD GOLF CLUB</div>

        <!-- Sponsor hero -->
        <div id="sponsorHero" role="button" aria-label="Tournament Sponsor">
          <div id="sponsorHeroTitle">Tournament Sponsor</div>
          <div id="sponsorHeroRow">
            <img id="sponsorHeroLogo" alt="Sponsor Logo" />
            <div>
              <div id="sponsorHeroName"></div>
              <div class="meta" style="margin:2px 0 0; font-size:14px; opacity:.8;" id="sponsorHeroHint"></div>
            </div>
          </div>
        </div>

        <div class="pillRow">
          <div class="pill" id="statusPill">‚õ≥Ô∏è LIVE</div>
          <div class="pill" id="formatPill">Format: ‚Äî</div>
        </div>

        <div class="btnRow">
          <button id="refreshBtn">üîÑ Refresh</button>
          <a id="joinBtn" class="btn" href="./index.html">üë• Join Link</a>
          <button id="copyBtn">üìã Copy Leaderboard Link</button>
          <button id="tvBtn" class="tvBtn">üì∫ TV Mode</button>
          <button id="autoBtn" class="autoBtn">‚¨áÔ∏è Auto Scroll: Off</button>
        </div>
      </div>

      <!-- Top Teams -->
      <div class="section">
        <div class="sectionHead">
          <div>
            <div class="title">üèÜ TOP TEAMS</div>
            <div class="sub" id="lastUpdate">Last update: ‚Äî</div>
          </div>
          <div class="sub" id="topCount"></div>
        </div>
        <div id="topSlot"></div>
      </div>

      <!-- All Teams -->
      <div class="section">
        <div class="sectionHead">
          <div class="title">ALL TEAMS</div>
          <div class="sub" id="allCount">0 teams</div>
        </div>

        <div class="tableWrap" id="tableWrap">
          <table>
            <thead>
              <tr>
                <th style="width:110px;">RANK</th>
                <th>TEAM / PLAYER</th>
                <th style="width:120px;">GROUP</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- Modal -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalHead">
        <div>
          <div class="modalTitle" id="modalTitle">Team</div>
          <div class="modalSmall" id="modalSub">‚Äî</div>
        </div>
        <button class="closeBtn" id="modalClose">Close</button>
      </div>
      <div class="holesGrid">
        <div class="grid" id="gridFront"></div>
        <div style="height:10px"></div>
        <div class="grid" id="gridBack"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      collection,
      getDocs,
      onSnapshot,
      query
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ===== Firebase config (same project) =====
    const firebaseConfig = {
      apiKey: "AIzaSyBX2ycbIGEyQh-XgeOXtuhkyBT2XZvsHls",
      authDomain: "cypresswood-tournaments.firebaseapp.com",
      projectId: "cypresswood-tournaments",
      storageBucket: "cypresswood-tournaments.firebasestorage.app",
      messagingSenderId: "162441374966",
      appId: "1:162441374966:web:157285a2d5c39db1e810d7",
      measurementId: "G-HL6Y9CLV8K"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const $ = (id)=>document.getElementById(id);

    // ===== URL params =====
    const params = new URLSearchParams(location.search);
    const tournamentId = (params.get("t") || "").trim();

    // ===== DOM =====
    const pageMeta = $("pageMeta");
    const courseHeader = $("courseHeader");
    const statusPill = $("statusPill");
    const formatPill = $("formatPill");
    const joinBtn = $("joinBtn");
    const copyBtn = $("copyBtn");
    const refreshBtn = $("refreshBtn");
    const tvBtn = $("tvBtn");
    const autoBtn = $("autoBtn");

    const sponsorHero = $("sponsorHero");
    const sponsorHeroLogo = $("sponsorHeroLogo");
    const sponsorHeroName = $("sponsorHeroName");
    const sponsorHeroHint = $("sponsorHeroHint");

    const lastUpdate = $("lastUpdate");
    const topSlot = $("topSlot");
    const rows = $("rows");
    const allCount = $("allCount");

    // modal
    const modalBack = $("modalBack");
    const modalClose = $("modalClose");
    const modalTitle = $("modalTitle");
    const modalSub = $("modalSub");
    const gridFront = $("gridFront");
    const gridBack = $("gridBack");

    // ===== helpers =====
    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    function normalizeUrl(u){
      const s = (u || "").trim();
      if(!s) return "";
      if(/^https?:\/\//i.test(s)) return s;
      return "https://" + s;
    }

    // ‚úÖ This is the fix: always prefer playerName (then first row name) ‚Äî group is NOT the name
    function pickDisplayName(sub){
      const playerName = String(sub.playerName || "").trim();
      const namesArr = Array.isArray(sub.names) ? sub.names : [];
      const firstRowName = String(namesArr.find(n => String(n||"").trim()) || "").trim();
      const group = String(sub.group || "").trim();
      return playerName || firstRowName || (group ? `Team ${group}` : "Player");
    }

    function getScore(sub){
      // rank by first row total (works for scramble and your current ‚Äúone submission = one team‚Äù model)
      const totals = Array.isArray(sub.totals) ? sub.totals : [];
      const t0 = totals[0] || {};
      const tot = Number(t0.tot ?? 0) || 0;
      const out = Number(t0.out ?? 0) || 0;
      const inn = Number(t0.inn ?? 0) || 0;
      return { tot, out, inn };
    }

    function prettyTime(ts){
      try{
        const d = ts?.toDate ? ts.toDate() : (ts instanceof Date ? ts : null);
        if(!d) return "‚Äî";
        return d.toLocaleString();
      }catch(e){ return "‚Äî"; }
    }

    function courseHeaderFor(courseDefault){
      // Match the tournament default course header
      if(String(courseDefault).toLowerCase() === "cypress") return "./assets/cypress_header.png";
      return "./assets/cypresswood_header.png"; // tradition header in your repo naming
    }

    function renderSponsor(t){
      const name = String(t?.sponsorName || "").trim();
      const logo = String(t?.sponsorLogo || "").trim();
      const url  = normalizeUrl(t?.sponsorUrl || t?.sponsorWebsite || "");

      if(!name && !logo){
        sponsorHero.style.display = "none";
        sponsorHero.onclick = null;
        return;
      }

      sponsorHero.style.display = "block";
      sponsorHeroName.textContent = name || "Tournament Sponsor";

      if(logo){
        sponsorHeroLogo.src = logo;
        sponsorHeroLogo.style.display = "block";
      }else{
        sponsorHeroLogo.style.display = "none";
      }

      sponsorHeroHint.textContent = url ? "Tap to visit sponsor" : "";
      sponsorHero.style.cursor = url ? "pointer" : "default";
      sponsorHero.onclick = () => { if(url) window.open(url, "_blank"); };
    }

    function openModal(sub){
      const name = pickDisplayName(sub);
      const group = String(sub.group || "").trim();
      const course = String(sub.courseId || "").trim();
      const fmt = String(sub.format || "").trim();

      modalTitle.textContent = name;
      modalSub.textContent = `${course || "course"}${group ? " ‚Ä¢ Group " + group : ""}${fmt ? " ‚Ä¢ " + fmt : ""}`;

      // Build 18 holes, show p0 values (matches your current leaderboard ‚Äúteam score‚Äù approach)
      const scores = sub.scoresFlat || {};
      gridFront.innerHTML = "";
      gridBack.innerHTML = "";

      for(let h=1; h<=9; h++){
        const key = `p0_h${h}`;
        const v = String(scores[key] ?? "").trim();
        gridFront.appendChild(holeCell(h, v));
      }
      for(let h=10; h<=18; h++){
        const key = `p0_h${h}`;
        const v = String(scores[key] ?? "").trim();
        gridBack.appendChild(holeCell(h, v));
      }

      modalBack.style.display = "flex";
    }

    function holeCell(h, v){
      const div = document.createElement("div");
      div.className = "cell";
      const missing = !v;
      div.innerHTML = `
        <div class="h">Hole ${h}</div>
        <div class="v ${missing ? "miss":""}">${escapeHtml(v || "‚Äî")}</div>
      `;
      return div;
    }

    function closeModal(){
      modalBack.style.display = "none";
    }
    modalClose.addEventListener("click", closeModal);
    modalBack.addEventListener("click", (e)=>{ if(e.target === modalBack) closeModal(); });

    // ===== TV mode =====
    function setTVMode(on){
      document.body.classList.toggle("tv", !!on);
      tvBtn.textContent = on ? "üì∫ TV Mode: On" : "üì∫ TV Mode";
    }
    let tvOn = false;
    tvBtn.addEventListener("click", async ()=>{
      tvOn = !tvOn;
      setTVMode(tvOn);
      // optional: try fullscreen
      try{
        if(tvOn && document.documentElement.requestFullscreen) await document.documentElement.requestFullscreen();
        if(!tvOn && document.fullscreenElement && document.exitFullscreen) await document.exitFullscreen();
      }catch(e){}
    });

    // ===== Auto scroll =====
    let autoOn = false;
    let autoDir = 1;
    let autoTimer = null;

    function setAuto(on){
      autoOn = !!on;
      autoBtn.textContent = autoOn ? "‚¨áÔ∏è Auto Scroll: On" : "‚¨áÔ∏è Auto Scroll: Off";
      if(autoTimer) clearInterval(autoTimer);
      if(!autoOn) return;

      const wrap = $("tableWrap");
      autoTimer = setInterval(()=>{
        const max = wrap.scrollHeight - wrap.clientHeight;
        if(max <= 0) return;

        wrap.scrollTop += (1.2 * autoDir);
        if(wrap.scrollTop >= max - 2) autoDir = -1;
        if(wrap.scrollTop <= 0 + 2) autoDir = 1;
      }, 20);
    }
    autoBtn.addEventListener("click", ()=> setAuto(!autoOn));

    // ===== Links / copy =====
    function baseURL(){
      const url = new URL(location.href);
      url.hash = "";
      url.search = "";
      url.pathname = url.pathname.replace(/\/leaderboard\.html$/,"/");
      return url.toString();
    }

    function buildJoinLink(tId){
      return `${baseURL()}index.html?t=${encodeURIComponent(tId)}`;
    }
    function buildLbLink(tId){
      return `${baseURL()}leaderboard.html?t=${encodeURIComponent(tId)}`;
    }

    async function copyText(txt){
      try{
        await navigator.clipboard.writeText(txt);
        alert("Copied!");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        alert("Copied!");
      }
    }

    copyBtn.addEventListener("click", ()=>{
      const tId = tournamentId || "";
      if(!tId) return alert("Missing tournament ID in the URL (?t=...).");
      copyText(buildLbLink(tId));
    });

    refreshBtn.addEventListener("click", ()=> location.reload());

    // ===== main load =====
    if(!tournamentId){
      pageMeta.textContent = "Missing tournament ID. Open with ?t=YOUR_ID";
      statusPill.textContent = "‚ö†Ô∏è Missing ID";
    }else{
      pageMeta.textContent = `Tournament ID: ${tournamentId}`;
      joinBtn.href = buildJoinLink(tournamentId);
    }

    // Load tournament settings (course header, sponsor, format)
    async function loadTournament(){
      if(!tournamentId) return;
      const snap = await getDoc(doc(db, "tournaments", tournamentId));
      if(!snap.exists()){
        statusPill.textContent = "‚ö†Ô∏è Not found";
        return;
      }
      const t = snap.data() || {};
      const courseDefault = String(t.courseDefault || "tradition").trim();
      const fmt = String(t.format || "stroke").trim();
      const status = String(t.status || "open").trim();

      courseHeader.src = courseHeaderFor(courseDefault);
      courseHeader.alt = courseDefault === "cypress" ? "Cypress Header" : "Tradition Header";

      formatPill.textContent = `Format: ${fmt || "stroke"}`;
      statusPill.textContent = status === "closed" ? "‚õîÔ∏è CLOSED" : "‚õ≥Ô∏è LIVE";

      renderSponsor(t);
    }

    // Render leaderboard
    function render(subs){
      // sort by total asc
      const scored = subs.map(s => {
        const sc = getScore(s);
        return { sub:s, ...sc };
      }).sort((a,b)=> a.tot - b.tot);

      allCount.textContent = `${scored.length} team${scored.length===1?"":"s"}`;

      // last update
      const newest = subs
        .map(s => s.updatedAt)
        .filter(Boolean)
        .sort((a,b)=> (b?.seconds||0) - (a?.seconds||0))[0];

      lastUpdate.textContent = `Last update: ${prettyTime(newest)}`;

      // top card
      topSlot.innerHTML = "";
      if(scored.length){
        const top = scored[0];
        const name = pickDisplayName(top.sub);
        const group = String(top.sub.group || "").trim();
        const course = String(top.sub.courseId || "").trim() || "course";

        const card = document.createElement("div");
        card.className = "topCard";
        card.innerHTML = `
          <div class="rankLine">ü•á 1st</div>
          <div class="topName">${escapeHtml(name)}</div>
          <div class="topScore">${escapeHtml(top.tot)}</div>
          <div class="topMeta">Out ${escapeHtml(top.out)} ‚Ä¢ In ${escapeHtml(top.inn)}${group ? " ‚Ä¢ Group " + escapeHtml(group) : ""}</div>
          <div class="subline" style="margin-top:6px; opacity:.85;">${escapeHtml(course)} ‚Ä¢ tap for holes</div>
        `;
        card.addEventListener("click", ()=> openModal(top.sub));
        topSlot.appendChild(card);
      }else{
        const empty = document.createElement("div");
        empty.style.padding = "14px";
        empty.style.opacity = ".85";
        empty.textContent = "No teams yet ‚Äî once someone joins and enters a score, it will appear here.";
        topSlot.appendChild(empty);
      }

      // table
      rows.innerHTML = "";
      scored.forEach((x, idx)=>{
        const s = x.sub;
        const name = pickDisplayName(s);        // ‚úÖ FIXED
        const group = String(s.group || "").trim();
        const course = String(s.courseId || "").trim();
        const tr = document.createElement("tr");
        tr.style.cursor = "pointer";
        tr.innerHTML = `
          <td><span class="rankBadge">#${idx+1}</span></td>
          <td>
            <div style="font-family:Cinzel,serif; font-weight:900; font-size:22px;">${escapeHtml(name)}</div>
            <div class="subline">${escapeHtml(course || "course")} ‚Ä¢ tap for holes</div>
          </td>
          <td>${group ? `<span class="groupPill">${escapeHtml(group)}</span>` : `<span class="groupPill">‚Äî</span>`}</td>
        `;
        tr.addEventListener("click", ()=> openModal(s));
        rows.appendChild(tr);
      });
    }

    async function startLive(){
      await loadTournament();

      if(!tournamentId) return;

      // Live updates from submissions
      const subCol = collection(db, "tournaments", tournamentId, "submissions");
      const qy = query(subCol);

      onSnapshot(qy, (snap)=>{
        const subs = [];
        snap.forEach(docSnap => subs.push(docSnap.data() || {}));
        render(subs);
      }, (err)=>{
        console.error("Leaderboard listen failed", err);
        statusPill.textContent = "‚ö†Ô∏è Error";
      });
    }

    startLive();
  </script>
  <div style="
  text-align:center;
  font-size:12px;
  padding:16px;
  opacity:.7;
  font-family:Cinzel, serif;
">
  ¬© Cypresswood Golf Club ‚Ä¢
  <a href="./privacy.html">Privacy Policy</a>
</div>
</body>
</html>
