<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Live Leaderboard</title>

  <meta name="theme-color" content="#0d2a55">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --paper:#e9e2d4;
      --card:#efe7d7;
      --ink:#111;
      --muted: rgba(0,0,0,.65);
      --border:#7a4a0b;

      --navy:#0d2a55;
      --navy2:#0b2246;
      --gold:#caa24a;

      --row2: rgba(255,255,255,.72);

      --good:#2f6b2f;
      --bad:#b6422d;

      /* ESPN-ish greens */
      --fairway1:#0f5a34;
      --fairway2:#0b3f26;
      --rough:#08301d;

      --stripe: rgba(13,42,85,.05);
      --stripe2: rgba(202,162,74,.06);
    }

    *{ -webkit-tap-highlight-color: transparent; box-sizing:border-box; }
    body{
      margin:0;
      background:
        radial-gradient(circle at 18% 0%, rgba(13,42,85,.12), transparent 55%),
        radial-gradient(circle at 82% 14%, rgba(202,162,74,.12), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.04), transparent 28%),
        var(--paper);
      color: var(--ink);
      font-family: Georgia, 'Times New Roman', serif;
    }

    .wrap{ max-width: 1120px; margin: 0 auto; padding: 12px 12px 92px; }

    .card{
      background: var(--card);
      border: 3px solid var(--border);
      border-radius: 14px;
      overflow:hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
    }

    /* ===== Top Banner ===== */
    .top{
      position:relative;
      padding: 12px 12px 10px;
      background:
        linear-gradient(135deg, rgba(13,42,85,.24), rgba(13,42,85,.06)),
        var(--card);
      border-bottom: 1px solid rgba(0,0,0,.10);
    }

    .topRow{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .brand{
      display:flex; gap:10px; align-items:center;
      min-width: 240px;
    }

    .courseHeaderMini{
      width: 150px;
      height: 44px;
      object-fit: contain;
      background: rgba(255,255,255,.55);
      border: 2px solid rgba(0,0,0,.12);
      border-radius: 12px;
      padding: 6px 10px;
    }

    .titleBlock{
      display:flex; flex-direction:column; gap:2px;
    }

    h1{
      margin:0;
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .7px;
      font-size: 18px;
      line-height: 1.05;
    }
    .clubName{
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .5px;
      font-size: 12px;
      opacity:.9;
    }
    .meta{
      margin-top:2px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }

    .pillRow{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.55);
      font-weight: 900;
      font-size: 12px;
      white-space:nowrap;
    }
    .pill.live{
      border-color: rgba(47,107,47,.35);
      background: rgba(47,107,47,.10);
      color: #114011;
    }
    .pill.mode{
      border-color: rgba(13,42,85,.25);
      background: rgba(13,42,85,.10);
      color: var(--navy2);
    }
    .pill.par{
      border-color: rgba(202,162,74,.25);
      background: rgba(202,162,74,.10);
      color: #4a3a10;
    }

    .actions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    button, a.btn{
      border: 2px solid rgba(0,0,0,.15);
      background: rgba(255,255,255,.55);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      font-size: 14px;
      cursor:pointer;
      text-decoration:none;
      color: inherit;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    button:active, a.btn:active{ transform: translateY(1px); }

    .primary{
      border-color: rgba(13,42,85,.30);
      background: rgba(13,42,85,.12);
      color: var(--navy2);
    }
    .green{
      border-color: rgba(47,107,47,.30);
      background: rgba(47,107,47,.12);
      color: #114011;
    }

    /* ===== Sponsor Hero ===== */
    #sponsorHero{
      display:none;
      margin-top: 10px;
      border-radius: 14px;
      border: 2px solid rgba(0,0,0,.12);
      background:
        linear-gradient(135deg, rgba(202,162,74,.18), rgba(13,42,85,.08)),
        rgba(255,255,255,.55);
      padding: 10px 12px;
    }
    #sponsorHeroTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    #sponsorHeroTitle{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .5px;
      opacity: .95;
    }
    #sponsorHeroRow{
      margin-top: 8px;
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    #sponsorHeroLogo{
      width: 44px; height: 44px;
      border-radius: 12px;
      object-fit: cover;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(0,0,0,.06);
      display:none;
    }
    #sponsorHeroName{
      font-weight: 1000;
      font-size: 16px;
    }
    #sponsorHeroLink{
      display:none;
      border:2px solid rgba(13,42,85,.20);
      background: rgba(13,42,85,.10);
      color: var(--navy2);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 900;
      text-decoration:none;
    }

    /* ===== Leaderboard ===== */
    .board{
      padding: 10px 10px 14px;
      background: var(--card);
    }

    .hdr{
      display:grid;
      grid-template-columns: 74px 1.35fr 120px 90px 90px;
      gap:10px;
      align-items:center;
      padding: 10px 10px;
      border-radius: 12px;
      background: linear-gradient(90deg, rgba(13,42,85,.12), rgba(202,162,74,.10));
      border: 2px solid rgba(0,0,0,.12);
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .5px;
      font-size: 12px;
    }

    .list{
      margin-top: 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .row{
      display:grid;
      grid-template-columns: 74px 1.35fr 120px 90px 90px;
      gap:10px;
      align-items:center;
      padding: 12px 10px;
      border-radius: 14px;
      background: var(--row2);
      border: 2px solid rgba(0,0,0,.10);
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .row:nth-child(odd){
      background:
        linear-gradient(90deg, var(--stripe), transparent 55%),
        rgba(255,255,255,.72);
    }
    .row:nth-child(even){
      background:
        linear-gradient(90deg, var(--stripe2), transparent 55%),
        rgba(255,255,255,.72);
    }

    .row:active{ transform: translateY(1px); }

    .rankBox{
      display:flex; align-items:center; justify-content:center;
      width: 70px; height: 44px;
      border-radius: 12px;
      background: rgba(13,42,85,.12);
      border: 2px solid rgba(13,42,85,.20);
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 18px;
      position:relative;
    }
    .move{
      position:absolute;
      right: -6px;
      top: -6px;
      width: 26px;
      height: 26px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 900;
      border: 2px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.75);
    }
    .move.up{ color: #114011; border-color: rgba(47,107,47,.25); background: rgba(47,107,47,.10); }
    .move.down{ color: #5c1b11; border-color: rgba(182,66,45,.25); background: rgba(182,66,45,.10); }

    .name{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:0;
    }
    .mainName{
      font-weight: 1000;
      font-size: 16px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 100%;
    }
    .subName{
      font-size: 12px;
      font-weight: 900;
      color: rgba(0,0,0,.62);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chips{
      display:flex; gap:6px; flex-wrap:wrap;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 900;
      border: 2px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.70);
      color: rgba(0,0,0,.75);
    }
    .chip.gold{
      background: rgba(202,162,74,.14);
      border-color: rgba(202,162,74,.25);
      color: #4a3a10;
    }
    .chip.navy{
      background: rgba(13,42,85,.10);
      border-color: rgba(13,42,85,.20);
      color: var(--navy2);
    }

    .scoreBox{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:2px;
    }
    .score{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 22px;
      letter-spacing: .5px;
      color: var(--navy2);
    }
    .score.good{ color: #114011; }
    .score.bad{ color: #5c1b11; }
    .scoreSub{
      font-size: 11px;
      font-weight: 900;
      color: rgba(0,0,0,.60);
    }

    .thin{
      text-align:right;
      font-weight: 900;
      font-size: 14px;
      color: rgba(0,0,0,.78);
    }

    /* Top 1 glow */
    .row.top1{
      background:
        radial-gradient(circle at 10% 50%, rgba(202,162,74,.18), transparent 55%),
        radial-gradient(circle at 90% 30%, rgba(13,42,85,.14), transparent 55%),
        rgba(255,255,255,.72);
      border-color: rgba(202,162,74,.22);
    }

    .flash{ animation: flash 800ms ease-out; }
    @keyframes flash{
      0%{ box-shadow: 0 0 0 rgba(0,0,0,0); }
      25%{ box-shadow: 0 0 0 6px rgba(202,162,74,.18); }
      100%{ box-shadow: 0 0 0 rgba(0,0,0,0); }
    }

    /* ===== Sponsor ticker ===== */
    #ticker{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 20;
      border-top: 3px solid var(--border);
      background:
        linear-gradient(90deg, rgba(13,42,85,.18), rgba(202,162,74,.16)),
        rgba(239,231,215,.96);
      backdrop-filter: blur(6px);
    }
    .tickerTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 8px 12px;
      border-bottom: 1px solid rgba(0,0,0,.10);
    }
    .tickerLabel{
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .5px;
      font-size: 12px;
    }
    .tickerHint{
      font-size: 12px;
      font-weight: 900;
      color: rgba(0,0,0,.55);
    }
    .tickerTrackWrap{ overflow:hidden; white-space:nowrap; }
    .tickerTrack{
      display:inline-flex;
      align-items:center;
      gap:12px;
      padding: 10px 12px;
      animation: marquee 24s linear infinite;
      will-change: transform;
    }
    @keyframes marquee{
      0%{ transform: translateX(0); }
      100%{ transform: translateX(-50%); }
    }
    .sponsorPill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.65);
      text-decoration:none;
      color: inherit;
      font-weight: 1000;
      font-size: 13px;
      cursor:pointer;
    }
    .sponsorPill img{
      width: 26px; height: 26px;
      border-radius: 8px;
      object-fit: cover;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(0,0,0,.06);
    }

    /* ===== Modal (Broadcast Sheet) ===== */
    .modal{
      position: fixed;
      inset: 0;
      z-index: 50;
      display:none;
      align-items:flex-end;
      justify-content:center;
      background: rgba(0,0,0,.62);
      padding: 12px;
    }
    .modal.show{ display:flex; }

    .sheet{
      width: min(1020px, 100%);
      max-height: 90vh;
      overflow:auto;
      border-radius: 18px;
      border: 2px solid rgba(255,255,255,.18);
      background:
        radial-gradient(circle at 18% 0%, rgba(202,162,74,.22), transparent 60%),
        radial-gradient(circle at 82% 8%, rgba(13,42,85,.22), transparent 65%),
        rgba(239,231,215,.98);
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      position: relative;
    }

    .sheetBanner{
      position: relative;
      padding: 10px 12px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.20)),
        linear-gradient(90deg, var(--fairway1), var(--fairway2));
      border-bottom: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
    }
    .sheetBanner::after{
      content:"";
      position:absolute;
      inset:-40% -30%;
      background: linear-gradient(120deg, transparent 40%, rgba(255,255,255,.08) 50%, transparent 60%);
      transform: rotate(8deg);
      animation: sheen 2.2s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sheen{
      0%{ transform: translateX(-20%) rotate(8deg); opacity:.0; }
      35%{ opacity: .55; }
      60%{ opacity: .15; }
      100%{ transform: translateX(22%) rotate(8deg); opacity:0; }
    }

    .sheetBannerTop{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .sheetBannerLeft{ min-width: 220px; }
    .sheetName{
      margin:0;
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 18px;
      letter-spacing: .6px;
      color: rgba(255,255,255,.95);
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 100%;
    }
    .sheetSub{
      margin-top:6px;
      font-weight: 900;
      font-size: 12px;
      color: rgba(255,255,255,.80);
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
    }

    .sheetBannerRight{
      text-align:right;
      min-width: 160px;
    }
    .bigScore{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 40px;
      color: rgba(255,255,255,.96);
      text-shadow: 0 2px 14px rgba(0,0,0,.40);
      line-height: 1;
      letter-spacing: .6px;
    }
    .smallScore{
      margin-top:6px;
      font-weight: 900;
      font-size: 12px;
      color: rgba(255,255,255,.78);
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
    }

    .closeBtn{
      border: 2px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.92);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      height: fit-content;
      backdrop-filter: blur(6px);
    }
    .closeBtn:active{ transform: translateY(1px); }

    .sheetBody{
      padding: 12px;
      display:grid;
      gap:12px;
    }

    .cardBlock{
      border-radius: 18px;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.70);
      overflow:hidden;
    }

    .blockHdr{
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(0,0,0,.10);
      background:
        linear-gradient(90deg, rgba(13,42,85,.12), rgba(202,162,74,.10));
      font-family: Cinzel, serif;
      font-weight: 900;
      letter-spacing: .5px;
      font-size: 12px;
    }

    .scoreGrid{
      padding: 12px;
      display:grid;
      gap:10px;
    }

    .nine{
      display:grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 9px;
    }

    .holeCell{
      border-radius: 16px;
      border: 2px solid rgba(0,0,0,.12);
      background:
        radial-gradient(circle at 30% 0%, rgba(202,162,74,.10), transparent 60%),
        rgba(255,255,255,.82);
      padding: 10px 8px 10px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .holeCell::before{
      content:"";
      position:absolute;
      inset: -50% -50%;
      background: radial-gradient(circle at 60% 40%, rgba(13,42,85,.10), transparent 55%);
      transform: rotate(8deg);
      pointer-events:none;
    }

    .holeTop{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      position:relative;
      z-index:1;
    }
    .holeBadge{
      width: 30px; height: 30px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 12px;
      border: 2px solid rgba(13,42,85,.18);
      background: rgba(13,42,85,.10);
      color: var(--navy2);
    }
    .flag{
      width: 26px; height: 26px;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 14px;
      border: 2px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.75);
    }

    .holeScore{
      margin-top: 8px;
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 22px;
      color: #111;
      line-height: 1;
      position:relative;
      z-index:1;
    }

    .holeMeta{
      margin-top: 8px;
      display:flex;
      justify-content:center;
      gap:6px;
      flex-wrap:wrap;
      font-size: 10px;
      font-weight: 900;
      color: rgba(0,0,0,.60);
      position:relative;
      z-index:1;
    }
    .holeMeta span{
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.78);
    }

    .holeCell.birdie{
      border-color: rgba(47,107,47,.35);
      background:
        radial-gradient(circle at 30% 0%, rgba(47,107,47,.14), transparent 60%),
        rgba(255,255,255,.86);
    }
    .holeCell.eagle{
      border-color: rgba(202,162,74,.42);
      background:
        radial-gradient(circle at 30% 0%, rgba(202,162,74,.20), transparent 60%),
        rgba(255,255,255,.88);
      box-shadow: 0 0 0 4px rgba(202,162,74,.10) inset;
    }
    .holeCell.bogey{
      border-color: rgba(182,66,45,.30);
      background:
        radial-gradient(circle at 30% 0%, rgba(182,66,45,.10), transparent 60%),
        rgba(255,255,255,.86);
    }
    .holeCell.double{
      border-color: rgba(182,66,45,.40);
      box-shadow: 0 0 0 4px rgba(182,66,45,.09) inset;
    }
    .holeCell.blank{
      opacity:.75;
      background: rgba(255,255,255,.72);
    }

    .sumRow{
      padding: 10px 12px 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      border-top: 1px solid rgba(0,0,0,.10);
      background:
        linear-gradient(90deg, rgba(13,42,85,.06), rgba(202,162,74,.06));
    }
    .sumPill{
      display:flex; align-items:baseline; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.78);
      min-width: 160px;
      justify-content:space-between;
      font-weight: 1000;
    }
    .sumPill b{
      font-family: Cinzel, serif;
      letter-spacing: .4px;
      font-size: 12px;
      opacity:.9;
    }
    .sumPill span{
      font-family: Cinzel, serif;
      font-weight: 900;
      font-size: 18px;
      color: var(--navy2);
    }

    /* ===== TV Mode ===== */
    body.tv .wrap{ max-width: 1400px; padding: 12px 12px 70px; }
    body.tv h1{ font-size: 22px; }
    body.tv .row{ padding: 14px 12px; }
    body.tv .hdr{ font-size: 13px; }
    body.tv .score{ font-size: 26px; }
    body.tv .rankBox{ width: 78px; height: 48px; font-size: 20px; }
    body.tv .courseHeaderMini{ width: 200px; height: 52px; }

    @media (max-width: 900px){
      .hdr, .row{ grid-template-columns: 74px 1.2fr 120px 84px 84px; }
      .nine{ grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 740px){
      .hdr, .row{ grid-template-columns: 74px 1fr 120px; }
      .hdr .colThru, .hdr .colUpdated,
      .row .colThru, .row .colUpdated{ display:none; }
      .scoreBox{ align-items:flex-end; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="topRow">
          <div class="brand">
            <img id="courseHeaderMini" class="courseHeaderMini" src="./assets/cypresswood_header.png" alt="Course Header" />
            <div class="titleBlock">
              <h1 id="pageTitle">Live Leaderboard</h1>
              <div class="clubName" id="clubName">Cypresswood Golf Club</div>
              <div class="meta" id="pageMeta">Loadingâ€¦</div>
            </div>
          </div>

          <div class="pillRow">
            <div class="pill live" id="statusPill">â›³ LIVE</div>
            <div class="pill mode" id="formatPill">FORMAT: â€”</div>
            <div class="pill par" id="parPill">TOTAL PAR: â€”</div>
          </div>

          <div class="actions">
            <button class="primary" id="refreshBtn">ðŸ”„ Refresh</button>
            <a class="btn green" id="joinBtn" href="./index.html">ðŸ‘¥ Join</a>
            <button id="copyBtn">ðŸ“‹ Copy Link</button>
            <a class="btn" id="tvBtn" href="#">ðŸ“º TV</a>
          </div>
        </div>

        <div id="sponsorHero">
          <div id="sponsorHeroTop">
            <div id="sponsorHeroTitle">TOURNAMENT SPONSOR</div>
            <a id="sponsorHeroLink" href="#" target="_blank" rel="noopener">Visit Sponsor</a>
          </div>
          <div id="sponsorHeroRow">
            <img id="sponsorHeroLogo" alt="Sponsor Logo" />
            <div id="sponsorHeroName"></div>
          </div>
        </div>
      </div>

      <div class="board">
        <div class="hdr">
          <div>RANK</div>
          <div>TEAM / PLAYER</div>
          <div style="text-align:right;">TO PAR</div>
          <div class="colThru" style="text-align:right;">THRU</div>
          <div class="colUpdated" style="text-align:right;">UPDATED</div>
        </div>

        <div class="list" id="list"></div>
      </div>
    </div>
  </div>

  <div id="ticker" style="display:none;">
    <div class="tickerTop">
      <div class="tickerLabel">Sponsored by</div>
      <div class="tickerHint">(tap to open)</div>
    </div>
    <div class="tickerTrackWrap">
      <div class="tickerTrack" id="tickerTrack"></div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="sheet" role="dialog" aria-modal="true">
      <div class="sheetBanner">
        <div class="sheetBannerTop">
          <div class="sheetBannerLeft">
            <p class="sheetName" id="modalName">â€”</p>
            <div class="sheetSub" id="modalSub"></div>
          </div>

          <div class="sheetBannerRight">
            <div class="bigScore" id="modalScore">â€”</div>
            <div class="smallScore" id="modalScoreSub">â€”</div>
          </div>

          <button class="closeBtn" id="closeModal">âœ• Close</button>
        </div>
      </div>

      <div class="sheetBody">
        <div class="cardBlock">
          <div class="blockHdr">
            <div>Front 9</div>
            <div>Holes 1â€“9</div>
          </div>
          <div class="scoreGrid">
            <div class="nine" id="frontNine"></div>
          </div>
          <div class="sumRow">
            <div class="sumPill"><b>OUT</b> <span id="outSum">â€”</span></div>
            <div class="sumPill"><b>IN</b> <span id="inSum">â€”</span></div>
            <div class="sumPill"><b>TOTAL</b> <span id="totSum">â€”</span></div>
          </div>
        </div>

        <div class="cardBlock">
          <div class="blockHdr">
            <div>Back 9</div>
            <div>Holes 10â€“18</div>
          </div>
          <div class="scoreGrid">
            <div class="nine" id="backNine"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, onSnapshot, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBX2ycbIGEyQh-XgeOXtuhkyBT2XZvsHls",
      authDomain: "cypresswood-tournaments.firebaseapp.com",
      projectId: "cypresswood-tournaments",
      storageBucket: "cypresswood-tournaments.firebasestorage.app",
      messagingSenderId: "162441374966",
      appId: "1:162441374966:web:157285a2d5c39db1e810d7",
      measurementId: "G-HL6Y9CLV8K"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ===== Course meta for Par + HCP + playoff ordering =====
    const COURSE_TRADITION = {
      id:"tradition",
      headerMini:"./assets/cypresswood_header.png",
      clubName:"Cypresswood Golf Club",
      par:[4,4,3,4,5,4,5,3,4, 4,3,5,4,3,4,4,4,5],
      hcp:[7,17,11,1,3,13,9,15,5, 14,8,10,6,18,12,2,16,4]
    };

    const COURSE_CYPRESS = {
      id:"cypress",
      headerMini:"./assets/cypress_header.png",
      clubName:"Cypresswood Golf Club",
      par:[5,4,4,4,3,4,3,5,4, 4,4,4,4,3,5,3,5,4],
      hcp:[3,13,11,7,15,9,17,1,5, 6,10,12,14,18,2,16,4,8]
    };

    const COURSES = { tradition: COURSE_TRADITION, cypress: COURSE_CYPRESS };

    // ===== DOM =====
    const listEl = document.getElementById("list");
    const pageMeta = document.getElementById("pageMeta");
    const statusPill = document.getElementById("statusPill");
    const formatPill = document.getElementById("formatPill");
    const parPill = document.getElementById("parPill");
    const refreshBtn = document.getElementById("refreshBtn");
    const joinBtn = document.getElementById("joinBtn");
    const copyBtn = document.getElementById("copyBtn");
    const tvBtn = document.getElementById("tvBtn");
    const courseHeaderMini = document.getElementById("courseHeaderMini");
    const clubNameEl = document.getElementById("clubName");

    const sponsorHero = document.getElementById("sponsorHero");
    const sponsorHeroLogo = document.getElementById("sponsorHeroLogo");
    const sponsorHeroName = document.getElementById("sponsorHeroName");
    const sponsorHeroLink = document.getElementById("sponsorHeroLink");
    const ticker = document.getElementById("ticker");
    const tickerTrack = document.getElementById("tickerTrack");

    const modal = document.getElementById("modal");
    const closeModalBtn = document.getElementById("closeModal");
    const modalName = document.getElementById("modalName");
    const modalSub = document.getElementById("modalSub");
    const modalScore = document.getElementById("modalScore");
    const modalScoreSub = document.getElementById("modalScoreSub");
    const frontNine = document.getElementById("frontNine");
    const backNine = document.getElementById("backNine");
    const outSum = document.getElementById("outSum");
    const inSum = document.getElementById("inSum");
    const totSum = document.getElementById("totSum");

    // ===== URL + STATE =====
    const params = new URLSearchParams(location.search);
    const tournamentId = (params.get("t") || "").trim();
    const tvMode = params.get("tv") === "1";
    if (tvMode) document.body.classList.add("tv");

    let tournament = {
      name: "Tournament",
      date: "",
      organizer: "",
      courseDefault: "tradition",
      format: "stroke",
      sponsorName: "",
      sponsorLogo: "",
      sponsorUrl: "",
      sponsors: [],
      status: "open"
    };

    let course = COURSES[tournament.courseDefault] || COURSE_TRADITION;
    const lastRankByKey = new Map();

    function fmtFormat(f){
      const x = (f || "stroke").toLowerCase();
      if (x === "scramble") return "Scramble";
      if (x === "bestball") return "Best Ball";
      if (x === "skins") return "Skins";
      return "Stroke Play";
    }

    function safeNum(v){ const n = Number(v); return Number.isFinite(n) ? n : 0; }

    function normalizeUrl(u){
      const s = (u || "").trim();
      if(!s) return "";
      if(/^https?:\/\//i.test(s)) return s;
      return "https://" + s;
    }

    function tsToText(ts){
      try{
        const d = ts?.toDate ? ts.toDate() : null;
        if(!d) return "";
        const hh = d.getHours();
        const mm = String(d.getMinutes()).padStart(2,"0");
        const h12 = ((hh + 11) % 12) + 1;
        const ap = hh >= 12 ? "PM" : "AM";
        return `${h12}:${mm} ${ap}`;
      }catch(e){ return ""; }
    }

    function escapeHtml(s){
      return String(s || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function setCourseHeaderMini(courseId){
      const c = COURSES[courseId] || COURSE_TRADITION;
      courseHeaderMini.src = c.headerMini;
      courseHeaderMini.alt = courseId === "cypress" ? "Cypress Header" : "Tradition Header";
      clubNameEl.textContent = c.clubName || "Golf Club";
      course = c;

      const totalPar = c.par.reduce((a,b)=>a+(Number(b)||0),0);
      parPill.textContent = `TOTAL PAR: ${totalPar}`;
    }

    // ===== Par scoring helpers =====
    function getScore(scoresFlat, pIndex, hole){
      const key = `p${pIndex}_h${hole}`;
      const raw = scoresFlat?.[key];
      const n = parseInt(raw, 10);
      return Number.isFinite(n) ? n : null;
    }

    function derivePlayerScores(scoresFlat, pIndex){
      const out = [];
      for(let h=1; h<=18; h++) out.push(getScore(scoresFlat, pIndex, h));
      return out;
    }

    function deriveBestBall(scoresFlat, playerCount=6){
      const out = [];
      for(let h=1; h<=18; h++){
        let best = null;
        for(let p=0; p<playerCount; p++){
          const s = getScore(scoresFlat, p, h);
          if (s === null) continue;
          if (best === null || s < best) best = s;
        }
        out.push(best);
      }
      return out;
    }

    function calcThruFromScores(scoresArr18){
      let c = 0;
      for(let i=0;i<18;i++) if (scoresArr18[i] !== null) c++;
      return c;
    }

    function sumNine(scoresArr18, startIdx){
      let s = 0;
      for(let i=0;i<9;i++) s += (scoresArr18[startIdx+i] || 0);
      return s;
    }

    function totalFromScores(scoresArr18){
      return scoresArr18.reduce((a,v)=> a + (v || 0), 0);
    }

    function toParFromScores(scoresArr18){
      // only count holes with scores entered
      let rel = 0;
      for(let i=0;i<18;i++){
        const s = scoresArr18[i];
        if (s === null) continue;
        rel += (s - (course.par[i] || 0));
      }
      return rel;
    }

    function formatToPar(rel){
      // TV style: -3, E, +4
      if (rel === 0) return "E";
      return rel > 0 ? `+${rel}` : String(rel);
    }

    function toParClass(rel){
      if (rel === 0) return "";
      return rel < 0 ? "good" : "bad";
    }

    // ===== Scorecard playoff (hardest HCP hole order) =====
    function holesByHardestHcp(){
      const pairs = course.hcp.map((hcp, idx) => ({ hole: idx+1, hcp }));
      pairs.sort((a,b) => a.hcp - b.hcp);
      return pairs.map(p => p.hole);
    }

    function playoffKey(scoresArr18){
      const order = holesByHardestHcp();
      const key = [];
      for(const hole of order){
        const v = scoresArr18[hole-1];
        key.push(v === null ? 999 : v);
      }
      return key;
    }

    function comparePlayoff(aScores, bScores){
      const aKey = playoffKey(aScores);
      const bKey = playoffKey(bScores);
      for(let i=0;i<aKey.length;i++){
        if (aKey[i] < bKey[i]) return -1;
        if (aKey[i] > bKey[i]) return 1;
      }
      return 0;
    }

    // ===== Enterprise Sponsor rendering =====
    function getActiveSponsors(){
      const raw = Array.isArray(tournament.sponsors) ? tournament.sponsors : [];
      const active = raw.filter(s => s && s.active !== false && (String(s.name||"").trim() || String(s.logoUrl||"").trim()));
      active.sort((a,b) => (Number(a.sort ?? 999) || 999) - (Number(b.sort ?? 999) || 999));
      return active;
    }

    function pickHeroSponsor(active){
      // Prefer tier=title, else first
      const title = active.find(s => String(s.tier||"").toLowerCase() === "title");
      return title || active[0] || null;
    }

    function renderSponsors(){
      const active = getActiveSponsors();

      // fallback to legacy single sponsor if no sponsors array
      if (!active.length){
        const name = (tournament.sponsorName || "").trim();
        const logo = (tournament.sponsorLogo || "").trim();
        const url  = normalizeUrl(tournament.sponsorUrl || "");
        if (!name && !logo){
          sponsorHero.style.display = "none";
          ticker.style.display = "none";
          tickerTrack.innerHTML = "";
          return;
        }
        // hero
        sponsorHero.style.display = "block";
        sponsorHeroName.textContent = name || "Tournament Sponsor";
        if (logo){ sponsorHeroLogo.src = logo; sponsorHeroLogo.style.display = "block"; }
        else sponsorHeroLogo.style.display = "none";
        if (url){ sponsorHeroLink.href = url; sponsorHeroLink.style.display = "inline-flex"; }
        else sponsorHeroLink.style.display = "none";

        // ticker
        ticker.style.display = "block";
        const pill = `
          <a class="sponsorPill" href="${url || "#"}" target="_blank" rel="noopener"
             style="${url ? "" : "pointer-events:none; opacity:.75;"}">
            ${logo ? `<img src="${logo}" alt="Sponsor">` : `<img src="./assets/icon-192.png" alt="Sponsor">`}
            <span>${escapeHtml(name || "Tournament Sponsor")}</span>
          </a>`;
        tickerTrack.innerHTML = pill + pill + pill + pill;
        return;
      }

      // hero from enterprise
      const hero = pickHeroSponsor(active);
      const heroName = (hero?.name || "").trim();
      const heroLogo = (hero?.logoUrl || "").trim();
      const heroUrl  = normalizeUrl(hero?.website || "");

      sponsorHero.style.display = "block";
      sponsorHeroName.textContent = heroName || "Tournament Sponsor";
      if (heroLogo){ sponsorHeroLogo.src = heroLogo; sponsorHeroLogo.style.display = "block"; }
      else sponsorHeroLogo.style.display = "none";
      if (heroUrl){ sponsorHeroLink.href = heroUrl; sponsorHeroLink.style.display = "inline-flex"; }
      else sponsorHeroLink.style.display = "none";

      // ticker: all active sponsors
      ticker.style.display = "block";
      const pills = active.map(s => {
        const n = (s.name || "").trim() || "Sponsor";
        const l = (s.logoUrl || "").trim();
        const u = normalizeUrl(s.website || "");
        return `
          <a class="sponsorPill" href="${u || "#"}" target="_blank" rel="noopener"
             style="${u ? "" : "pointer-events:none; opacity:.75;"}">
            ${l ? `<img src="${l}" alt="Sponsor">` : `<img src="./assets/icon-192.png" alt="Sponsor">`}
            <span>${escapeHtml(n)}</span>
          </a>`;
      }).join("");

      // duplicate track so marquee loops smoothly
      tickerTrack.innerHTML = pills + pills;
    }

    // ===== Entry building (team/player) =====
    function buildEntriesFromSubmissionDoc(docData, docId){
      const deviceId = docId;
      const group = (docData.group || "").trim();
      const playerName = (docData.playerName || "").trim();
      const names = Array.isArray(docData.names) ? docData.names : [];
      const scoresFlat = docData.scoresFlat || {};
      const totals = Array.isArray(docData.totals) ? docData.totals : [];
      const updatedAt = docData.updatedAt;

      const teamName = group || (names[0] || playerName || "Team");
      const scorerName = playerName || names[0] || "";

      const base = {
        deviceId,
        group,
        playerName: scorerName,
        names,
        scoresFlat,
        totals,
        updatedAt,
        courseId: docData.courseId || tournament.courseDefault || "tradition"
      };

      const fmt = (tournament.format || "stroke").toLowerCase();

      if (fmt === "scramble"){
        const scores = derivePlayerScores(scoresFlat, 0);
        const total = safeNum(totals?.[0]?.tot ?? totalFromScores(scores));
        const thru = calcThruFromScores(scores);
        const toPar = toParFromScores(scores);
        return [{
          ...base,
          key: `scr_${deviceId}`,
          displayName: teamName,
          subLine: scorerName && group ? `Scorer: ${scorerName}` : "",
          kind: "team",
          scores,
          total,
          toPar,
          thru,
          skins: 0
        }];
      }

      if (fmt === "bestball"){
        const scores = deriveBestBall(scoresFlat, 6);
        const total = totalFromScores(scores);
        const thru = calcThruFromScores(scores);
        const toPar = toParFromScores(scores);
        return [{
          ...base,
          key: `bb_${deviceId}`,
          displayName: teamName,
          subLine: scorerName && group ? `Team â€¢ Scorer: ${scorerName}` : (scorerName ? `Team â€¢ ${scorerName}` : "Team"),
          kind: "team",
          scores,
          total,
          toPar,
          thru,
          skins: 0
        }];
      }

      if (fmt === "skins"){
        const out = [];
        for(let i=0;i<6;i++){
          const nm = (names[i] || "").trim();
          const display = nm || (i === 0 ? (playerName || teamName) : `Player ${i+1}`);
          const scores = derivePlayerScores(scoresFlat, i);
          const total = safeNum(totals?.[i]?.tot ?? totalFromScores(scores));
          const thru = calcThruFromScores(scores);
          const toPar = toParFromScores(scores);

          out.push({
            ...base,
            key: `sk_${deviceId}_p${i}`,
            displayName: display,
            subLine: group ? `Group: ${group}` : (teamName ? `Card: ${teamName}` : ""),
            kind: "player",
            playerIndex: i,
            scores,
            total,
            toPar,
            thru,
            skins: 0
          });
        }
        return out;
      }

      // stroke (default): 6 players
      const items = [];
      for(let i=0;i<6;i++){
        const nm = (names[i] || "").trim();
        const display = nm || (i === 0 ? (playerName || teamName) : `Player ${i+1}`);
        const scores = derivePlayerScores(scoresFlat, i);
        const total = safeNum(totals?.[i]?.tot ?? totalFromScores(scores));
        const thru = calcThruFromScores(scores);
        const toPar = toParFromScores(scores);

        items.push({
          ...base,
          key: `st_${deviceId}_p${i}`,
          displayName: display,
          subLine: group ? `Group: ${group}` : (teamName ? `Card: ${teamName}` : ""),
          kind: "player",
          playerIndex: i,
          scores,
          total,
          toPar,
          thru,
          skins: 0
        });
      }
      return items;
    }

    function computeSkins(entries){
      for(const e of entries) e.skins = 0;

      for(let h=1; h<=18; h++){
        let low = null;
        let lowEntry = null;
        let tie = false;

        for(const e of entries){
          const s = e.scores[h-1];
          if (s === null) continue;
          if (low === null || s < low){
            low = s;
            lowEntry = e;
            tie = false;
          } else if (s === low){
            tie = true;
          }
        }
        if (low !== null && lowEntry && !tie) lowEntry.skins++;
      }
    }

    function sortEntries(entries){
      const fmt = (tournament.format || "stroke").toLowerCase();

      if (fmt === "skins"){
        computeSkins(entries);
        entries.sort((a,b) => {
          if (b.skins !== a.skins) return b.skins - a.skins;
          if (a.toPar !== b.toPar) return a.toPar - b.toPar;
          return comparePlayoff(a.scores, b.scores);
        });
        return;
      }

      // âœ… primary sort: TO PAR
      entries.sort((a,b) => {
        if (a.toPar !== b.toPar) return a.toPar - b.toPar;
        // secondary: total strokes (only for stable ordering), then playoff
        if (a.total !== b.total) return a.total - b.total;
        return comparePlayoff(a.scores, b.scores);
      });
    }

    function formatScoreDisplay(e){
      const fmt = (tournament.format || "stroke").toLowerCase();
      if (fmt === "skins"){
        return { big: String(e.skins), sub: `Skins â€¢ ${formatToPar(e.toPar)}` };
      }
      return { big: formatToPar(e.toPar), sub: fmt === "bestball" ? "Best Ball" : (fmt === "scramble" ? "Team" : "Gross") };
    }

    // ===== T ranks =====
    function computeDisplayRanks(entries){
      // produces an array of strings: ["1", "T2", ...]
      const out = [];
      let lastKey = null;
      let lastRank = 0;

      for(let i=0;i<entries.length;i++){
        const e = entries[i];
        const tieKey = `${e.toPar}|${e.total}|${playoffKey(e.scores).join(",")}`;
        if (i === 0){
          lastKey = tieKey;
          lastRank = 1;
          out.push("1");
        } else {
          const isTie = (tieKey === lastKey);
          if (isTie){
            out.push(`T${lastRank}`);
          } else {
            lastRank = i + 1;
            lastKey = tieKey;
            out.push(String(lastRank));
          }
        }
      }
      // normalize first row if tied with second: show T1
      if (out.length >= 2 && out[1] === "T1") out[0] = "T1";
      return out;
    }

    function render(entries){
      if (!entries.length){
        listEl.innerHTML = `<div style="padding:14px; font-weight:900; opacity:.75;">No submissions yet.</div>`;
        return;
      }

      const displayRanks = computeDisplayRanks(entries);

      const currentRankByKey = new Map();
      entries.forEach((e, idx) => currentRankByKey.set(e.key, idx+1));

      const html = entries.map((e, idx) => {
        const prev = lastRankByKey.get(e.key);
        const rankNum = idx + 1;
        const movedUp = (prev && rankNum < prev);
        const movedDown = (prev && rankNum > prev);
        const moveBadge = prev ? (movedUp ? `<div class="move up">â–²</div>` : (movedDown ? `<div class="move down">â–¼</div>` : ``)) : ``;

        const topClass = rankNum === 1 ? "top1" : "";
        const flash = prev && (movedUp || movedDown) ? "flash" : "";

        const s = formatScoreDisplay(e);
        const updatedText = tsToText(e.updatedAt);

        const chips = [];
        if ((tournament.format || "").toLowerCase() === "skins"){
          chips.push(`<span class="chip gold">Skins: ${e.skins}</span>`);
        }
        chips.push(`<span class="chip navy">${escapeHtml(fmtFormat(tournament.format))}</span>`);
        if (e.thru) chips.push(`<span class="chip">Thru ${e.thru}</span>`);

        const scoreCls = `score ${toParClass(e.toPar)}`;

        return `
          <div class="row ${topClass} ${flash}" data-key="${escapeHtml(e.key)}">
            <div class="rankBox">${displayRanks[idx]}${moveBadge}</div>

            <div class="name">
              <div class="mainName" title="${escapeHtml(e.displayName)}">${escapeHtml(e.displayName)}</div>
              ${e.subLine ? `<div class="subName">${escapeHtml(e.subLine)}</div>` : (e.kind === "team" && e.playerName && e.displayName !== e.playerName ? `<div class="subName">${escapeHtml(e.playerName)}</div>` : ``)}
              <div class="chips">${chips.join("")}</div>
            </div>

            <div class="scoreBox">
              <div class="${scoreCls}">${escapeHtml(s.big)}</div>
              <div class="scoreSub">${escapeHtml(s.sub)}</div>
            </div>

            <div class="thin colThru">${e.thru || 0}</div>
            <div class="thin colUpdated">${escapeHtml(updatedText || "")}</div>
          </div>
        `;
      }).join("");

      listEl.innerHTML = html;
      currentRankByKey.forEach((r,k) => lastRankByKey.set(k,r));

      listEl.querySelectorAll(".row").forEach(el => {
        el.addEventListener("click", () => {
          const key = el.getAttribute("data-key");
          const e = entries.find(x => x.key === key);
          if (e) openModal(e);
        });
      });
    }

    function resultClass(score, par){
      if (score === null) return "blank";
      const d = score - par;
      if (d <= -2) return "eagle";
      if (d === -1) return "birdie";
      if (d === 0) return "par";
      if (d === 1) return "bogey";
      if (d >= 2) return "double";
      return "par";
    }

    function openModal(e){
      modalName.textContent = e.displayName || "Scorecard";
      const fmt = fmtFormat(tournament.format);
      const updatedText = tsToText(e.updatedAt);

      const tags = [];
      if (tournament.name) tags.push(`ðŸ† ${tournament.name}`);
      tags.push(`â›³ ${fmt}`);
      if (e.group) tags.push(`ðŸ‘¥ ${e.group}`);
      if (e.playerName) tags.push(`âœï¸ ${e.playerName}`);
      if (updatedText) tags.push(`ðŸ•’ ${updatedText}`);
      if (e.thru) tags.push(`âœ… Thru ${e.thru}`);

      modalSub.innerHTML = tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("");

      const scoreDisplay = formatScoreDisplay(e);
      modalScore.textContent = scoreDisplay.big;
      modalScoreSub.textContent = scoreDisplay.sub;

      frontNine.innerHTML = "";
      backNine.innerHTML = "";

      for(let h=1; h<=18; h++){
        const score = e.scores[h-1];
        const par = course.par[h-1];
        const hcp = course.hcp[h-1];

        const cell = document.createElement("div");
        cell.className = `holeCell ${resultClass(score, par)}`;

        const top = document.createElement("div");
        top.className = "holeTop";

        const badge = document.createElement("div");
        badge.className = "holeBadge";
        badge.textContent = String(h);

        const flag = document.createElement("div");
        flag.className = "flag";
        flag.textContent = "â›³ï¸";

        top.appendChild(badge);
        top.appendChild(flag);

        const holeScore = document.createElement("div");
        holeScore.className = "holeScore";
        holeScore.textContent = (score === null) ? "â€”" : String(score);

        const holeMeta = document.createElement("div");
        holeMeta.className = "holeMeta";
        holeMeta.innerHTML = `<span>Par ${par}</span><span>HCP ${hcp}</span>`;

        cell.appendChild(top);
        cell.appendChild(holeScore);
        cell.appendChild(holeMeta);

        if (h <= 9) frontNine.appendChild(cell);
        else backNine.appendChild(cell);
      }

      const outV = sumNine(e.scores, 0);
      const inV = sumNine(e.scores, 9);
      outSum.textContent = String(outV);
      inSum.textContent = String(inV);

      if ((tournament.format || "").toLowerCase() === "skins"){
        totSum.textContent = `${formatToPar(e.toPar)} (Skins ${e.skins})`;
      } else {
        totSum.textContent = String(formatToPar(e.toPar));
      }

      modal.classList.add("show");
    }

    function closeModal(){ modal.classList.remove("show"); }
    closeModalBtn.addEventListener("click", closeModal);
    modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });

    // ===== Boot =====
    if (!tournamentId){
      pageMeta.textContent = "Missing tournament id (?t=...)";
      statusPill.textContent = "âš ï¸ MISSING TOURNAMENT";
      statusPill.classList.remove("live");
      formatPill.textContent = "FORMAT: â€”";
      parPill.textContent = "TOTAL PAR: â€”";
      joinBtn.href = "./index.html";
    } else {
      joinBtn.href = `./index.html?t=${encodeURIComponent(tournamentId)}`;
      tvBtn.href = `${location.pathname}?t=${encodeURIComponent(tournamentId)}&tv=1`;

      copyBtn.addEventListener("click", async () => {
        try{
          await navigator.clipboard.writeText(location.href);
          copyBtn.textContent = "âœ… Copied";
          setTimeout(()=> copyBtn.textContent = "ðŸ“‹ Copy Link", 900);
        }catch(e){
          alert("Copy blocked. Tap the address bar and copy the URL.");
        }
      });

      refreshBtn.addEventListener("click", () => location.reload());

      try{
        const tSnap = await getDoc(doc(db, "tournaments", tournamentId));
        if (tSnap.exists()){
          const t = tSnap.data() || {};
          tournament = {
            ...tournament,
            ...t,
            sponsorUrl: t.sponsorUrl || t.sponsorWebsite || "",
            sponsors: Array.isArray(t.sponsors) ? t.sponsors : []
          };

          pageMeta.textContent = `${tournament.name || "Tournament"}${tournament.date ? " â€¢ " + tournament.date : ""}`;
          formatPill.textContent = `FORMAT: ${fmtFormat(tournament.format)}`;

          setCourseHeaderMini(tournament.courseDefault || "tradition");
          renderSponsors();

          if ((tournament.status || "open") === "closed"){
            statusPill.textContent = "â›” CLOSED";
            statusPill.classList.remove("live");
          } else {
            statusPill.textContent = "â›³ LIVE";
            statusPill.classList.add("live");
          }
        } else {
          pageMeta.textContent = "Tournament not found.";
          statusPill.textContent = "âš ï¸ NOT FOUND";
          statusPill.classList.remove("live");
        }
      }catch(e){
        pageMeta.textContent = "Tournament load error.";
        statusPill.textContent = "âš ï¸ ERROR";
        statusPill.classList.remove("live");
      }

      const subCol = collection(db, "tournaments", tournamentId, "submissions");
      const q = query(subCol);

      onSnapshot(q, (snap) => {
        const entries = [];
        snap.forEach(d => {
          const built = buildEntriesFromSubmissionDoc(d.data() || {}, d.id);
          for(const b of built) entries.push(b);
        });
        sortEntries(entries);
        render(entries);
      }, () => {
        pageMeta.textContent = "Live updates blocked (rules/network).";
      });

      // TV auto-scroll (bounce)
      if (tvMode){
        let dir = 1;
        setInterval(() => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          if (maxScroll <= 0) return;
          const y = window.scrollY;
          const step = 2.2;
          if (y >= maxScroll - 4) dir = -1;
          if (y <= 4) dir = 1;
          window.scrollTo({ top: y + (step * dir), behavior: "auto" });
        }, 30);
      }
    }
  </script>
</body>
</html>
